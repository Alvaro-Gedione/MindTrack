<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Inserção - API Google Apps Script</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .api-url {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            word-break: break-all;
            font-family: monospace;
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #3367d6;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .progress {
            margin: 10px 0;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: #4285f4;
            transition: width 0.3s;
        }
        .section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>
<body>
    <h1>🔧 Teste de Inserção - API Google Apps Script</h1>
    
    <div class="container">
        <h2>🔗 Configuração da API</h2>
        <div>
            <label for="apiUrl">URL da sua API (Web App):</label>
            <input type="text" id="apiUrl" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px;" 
                   placeholder="https://script.google.com/macros/s/AKfycbycScdDY666D624_lBdXk5VHpjoYq1EKCN_FYKdFWGcTb0hB_q_mOrrHmAjx1yhvFVktQ/exec">
            <small>Cole aqui a URL do seu Web App do Google Apps Script</small>
        </div>
    </div>

    <div class="container">
        <div class="section">
            <h2>👥 Criar 10 Usuários</h2>
            <p>Usuários com dados aleatórios para teste</p>
            <button onclick="criarUsuarios()" id="btnUsuarios">Criar 10 Usuários</button>
            <div class="progress" id="progressUsuarios" style="display: none;">
                <div class="progress-bar" id="progressBarUsuarios" style="width: 0%"></div>
            </div>
            <div class="result" id="resultUsuarios"></div>
        </div>

        <div class="section">
            <h2>🏢 Criar 10 Departamentos</h2>
            <p>Departamentos com nomes aleatórios</p>
            <button onclick="criarDepartamentos()" id="btnDepartamentos">Criar 10 Departamentos</button>
            <div class="progress" id="progressDepartamentos" style="display: none;">
                <div class="progress-bar" id="progressBarDepartamentos" style="width: 0%"></div>
            </div>
            <div class="result" id="resultDepartamentos"></div>
        </div>

        <div class="section">
            <h2>📊 Criar 10 Registros de Dados</h2>
            <p>Dados de check-in diário (requer usuários criados)</p>
            <button onclick="criarDados()" id="btnDados">Criar 10 Registros</button>
            <div class="progress" id="progressDados" style="display: none;">
                <div class="progress-bar" id="progressBarDados" style="width: 0%"></div>
            </div>
            <div class="result" id="resultDados"></div>
        </div>

        <div class="section">
            <h2>🚀 Criar Tudo (30 Registros)</h2>
            <p>Cria 10 usuários, 10 departamentos e 10 registros de dados</p>
            <button onclick="criarTudo()" id="btnTudo">Criar Todos os Dados</button>
            <div class="progress" id="progressTudo" style="display: none;">
                <div class="progress-bar" id="progressBarTudo" style="width: 0%"></div>
            </div>
            <div class="result" id="resultTudo"></div>
        </div>
    </div>

    <script>
        // URL da sua API - será preenchida pelo usuário
        let API_URL = '';

        // Arrays para armazenar IDs criados
        let usuariosCriados = [];
        let departamentosCriados = [];

        // Dados de exemplo
        const nomes = ['Ana Silva', 'Carlos Santos', 'Maria Oliveira', 'João Pereira', 'Fernanda Costa', 
                      'Ricardo Almeida', 'Juliana Rodrigues', 'Pedro Souza', 'Camila Lima', 'Lucas Ferreira'];
        
        const cargos = ['Analista', 'Gerente', 'Desenvolvedor', 'Designer', 'Coordenador', 
                       'Estagiário', 'Diretor', 'Consultor', 'Supervisor', 'Assistente'];
        
        const departamentos = ['TI', 'RH', 'Financeiro', 'Marketing', 'Vendas', 
                              'Operações', 'Jurídico', 'Compras', 'Logística', 'Qualidade'];
        
        const niveisAcesso = [1, 2, 3, 4, 5];

        // Função para fazer requisições à API
        async function fazerRequisicao(acao, dados = null, metodo = 'POST') {
            const apiUrl = document.getElementById('apiUrl').value;
            if (!apiUrl) {
                alert('Por favor, insira a URL da API');
                return null;
            }

            API_URL = apiUrl;

            try {
                let url = API_URL;
                let options = {
                    method: metodo,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    mode: 'no-cors' // Importante para Apps Script
                };

                if (metodo === 'POST' && dados) {
                    options.body = JSON.stringify(dados);
                } else if (metodo === 'GET' && acao) {
                    url += `?action=${acao}`;
                    // Adicionar parâmetros extras se necessário
                    if (dados) {
                        const params = new URLSearchParams(dados);
                        url += `&${params.toString()}`;
                    }
                }

                const response = await fetch(url, options);
                
                // Para no-cors, não podemos ler a resposta diretamente
                // Mas podemos assumir sucesso se não houver erro de rede
                return {
                    success: true,
                    message: 'Requisição enviada com sucesso (modo no-cors)'
                };
                
            } catch (error) {
                console.error('Erro na requisição:', error);
                return {
                    success: false,
                    error: error.message
                };
            }
        }

        // Função para criar usuários
        async function criarUsuarios() {
            const btn = document.getElementById('btnUsuarios');
            const progress = document.getElementById('progressUsuarios');
            const progressBar = document.getElementById('progressBarUsuarios');
            const resultDiv = document.getElementById('resultUsuarios');

            btn.disabled = true;
            progress.style.display = 'block';
            resultDiv.innerHTML = 'Iniciando criação de usuários...';

            usuariosCriados = []; // Reset array

            let resultados = [];
            let sucessos = 0;

            for (let i = 0; i < 10; i++) {
                const usuarioData = {
                    Nome: nomes[i],
                    Email: `usuario${i+1}@empresa.com`,
                    Senha: `senha${i+1}`,
                    Departamento: departamentos[Math.floor(Math.random() * departamentos.length)],
                    Cargo: cargos[Math.floor(Math.random() * cargos.length)],
                    Nivel_Acesso: niveisAcesso[Math.floor(Math.random() * niveisAcesso.length)]
                };

                const resultado = await fazerRequisicao('postUsuario', {
                    action: 'postUsuario',
                    data: usuarioData
                });

                resultados.push({
                    usuario: usuarioData.Nome,
                    resultado: resultado
                });

                if (resultado && resultado.success) {
                    sucessos++;
                    // Simular o ID do usuário criado
                    usuariosCriados.push(`USER_${Math.random().toString(36).substr(2, 8)}`);
                }

                // Atualizar progresso
                const progresso = ((i + 1) / 10) * 100;
                progressBar.style.width = `${progresso}%`;
                resultDiv.innerHTML = `Progresso: ${i+1}/10 usuários\nSucessos: ${sucessos}\nÚltimo: ${usuarioData.Nome}`;

                // Pequeno delay para não sobrecarregar
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            btn.disabled = false;
            resultDiv.className = 'result ' + (sucessos === 10 ? 'success' : 'error');
            resultDiv.innerHTML = `Criação de usuários concluída!\n\n` +
                                `Total: 10\nSucessos: ${sucessos}\nFalhas: ${10 - sucessos}\n\n` +
                                `IDs criados: ${usuariosCriados.join(', ')}`;
        }

        // Função para criar departamentos
        async function criarDepartamentos() {
            const btn = document.getElementById('btnDepartamentos');
            const progress = document.getElementById('progressDepartamentos');
            const progressBar = document.getElementById('progressBarDepartamentos');
            const resultDiv = document.getElementById('resultDepartamentos');

            btn.disabled = true;
            progress.style.display = 'block';
            resultDiv.innerHTML = 'Iniciando criação de departamentos...';

            departamentosCriados = []; // Reset array

            let resultados = [];
            let sucessos = 0;

            for (let i = 0; i < 10; i++) {
                const departamentoData = {
                    Departamento: `${departamentos[i]} ${Math.floor(Math.random() * 100)}`,
                    ID_Usuarios: usuariosCriados.length > 0 ? 
                                usuariosCriados.slice(0, Math.floor(Math.random() * 3) + 1).join(',') : ''
                };

                const resultado = await fazerRequisicao('postDepartamento', {
                    action: 'postDepartamento',
                    data: departamentoData
                });

                resultados.push({
                    departamento: departamentoData.Departamento,
                    resultado: resultado
                });

                if (resultado && resultado.success) {
                    sucessos++;
                    departamentosCriados.push(departamentoData.Departamento);
                }

                // Atualizar progresso
                const progresso = ((i + 1) / 10) * 100;
                progressBar.style.width = `${progresso}%`;
                resultDiv.innerHTML = `Progresso: ${i+1}/10 departamentos\nSucessos: ${sucessos}\nÚltimo: ${departamentoData.Departamento}`;

                await new Promise(resolve => setTimeout(resolve, 500));
            }

            btn.disabled = false;
            resultDiv.className = 'result ' + (sucessos === 10 ? 'success' : 'error');
            resultDiv.innerHTML = `Criação de departamentos concluída!\n\n` +
                                `Total: 10\nSucessos: ${sucessos}\nFalhas: ${10 - sucessos}\n\n` +
                                `Departamentos criados: ${departamentosCriados.join(', ')}`;
        }

        // Função para criar dados
        async function criarDados() {
            const btn = document.getElementById('btnDados');
            const progress = document.getElementById('progressDados');
            const progressBar = document.getElementById('progressBarDados');
            const resultDiv = document.getElementById('resultDados');

            if (usuariosCriados.length === 0) {
                alert('Crie usuários primeiro ou use IDs existentes');
                return;
            }

            btn.disabled = true;
            progress.style.display = 'block';
            resultDiv.innerHTML = 'Iniciando criação de dados...';

            let resultados = [];
            let sucessos = 0;

            for (let i = 0; i < 10; i++) {
                const dadosData = {
                    UserID_Anonimo: usuariosCriados[Math.floor(Math.random() * usuariosCriados.length)],
                    Qualidade_Sono: Math.floor(Math.random() * 10) + 1, // 1-10
                    Nivel_Estresse: Math.floor(Math.random() * 10) + 1, // 1-10
                    Nivel_Energia: Math.floor(Math.random() * 10) + 1   // 1-10
                };

                const resultado = await fazerRequisicao('postDados', {
                    action: 'postDados',
                    data: dadosData
                });

                resultados.push({
                    usuario: dadosData.UserID_Anonimo,
                    resultado: resultado
                });

                if (resultado && resultado.success) {
                    sucessos++;
                }

                // Atualizar progresso
                const progresso = ((i + 1) / 10) * 100;
                progressBar.style.width = `${progresso}%`;
                resultDiv.innerHTML = `Progresso: ${i+1}/10 registros\nSucessos: ${sucessos}\nÚltimo usuário: ${dadosData.UserID_Anonimo}`;

                await new Promise(resolve => setTimeout(resolve, 500));
            }

            btn.disabled = false;
            resultDiv.className = 'result ' + (sucessos === 10 ? 'success' : 'error');
            resultDiv.innerHTML = `Criação de dados concluída!\n\n` +
                                `Total: 10\nSucessos: ${sucessos}\nFalhas: ${10 - sucessos}\n\n` +
                                `Dados de check-in criados com sucesso!`;
        }

        // Função para criar tudo
        async function criarTudo() {
            const btn = document.getElementById('btnTudo');
            const progress = document.getElementById('progressTudo');
            const progressBar = document.getElementById('progressBarTudo');
            const resultDiv = document.getElementById('resultTudo');

            btn.disabled = true;
            progress.style.display = 'block';
            resultDiv.innerHTML = 'Iniciando criação completa...';

            // Criar usuários
            resultDiv.innerHTML = 'Criando usuários (1/3)...';
            await criarUsuarios();
            
            // Criar departamentos
            resultDiv.innerHTML += '\n\nCriando departamentos (2/3)...';
            await criarDepartamentos();
            
            // Criar dados
            resultDiv.innerHTML += '\n\nCriando dados (3/3)...';
            await criarDados();

            progressBar.style.width = '100%';
            btn.disabled = false;
            resultDiv.className = 'result success';
            resultDiv.innerHTML = '✅ Criação completa concluída!\n\n' +
                                '📊 Resumo:\n' +
                                `• ${usuariosCriados.length} usuários criados\n` +
                                `• ${departamentosCriados.length} departamentos criados\n` +
                                `• 10 registros de dados criados\n\n` +
                                '🎉 Todos os dados foram inseridos com sucesso!';
        }

        // Exemplo de URLs de teste (para referência)
        document.addEventListener('DOMContentLoaded', function() {
            const apiUrlInput = document.getElementById('apiUrl');
            apiUrlInput.placeholder = 'https://script.google.com/macros/s/AKfycbycScdDY666D624_lBdXk5VHpjoYq1EKCN_FYKdFWGcTb0hB_q_mOrrHmAjx1yhvFVktQ/exec';
            
            // Adicionar exemplo clicável
            const exemploUrl = 'https://script.google.com/macros/s/AKfycbycScdDY666D624_lBdXk5VHpjoYq1EKCN_FYKdFWGcTb0hB_q_mOrrHmAjx1yhvFVktQ/exec';
            apiUrlInput.value = exemploUrl;
        });
    </script>
</body>
</html>